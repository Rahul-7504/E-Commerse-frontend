<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Your Shopping Cart | E-Commerce</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #4361ee;
      --secondary-color: #3f37c9;
      --accent-color: #4895ef;
      --light-color: #f8f9fa;
      --dark-color: #212529;
      --success-color: #4cc9f0;
      --danger-color: #f72585;
      --border-radius: 8px;
      --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      color: var(--dark-color);
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    header {
      background-color: white;
      box-shadow: var(--box-shadow);
      padding: 20px 0;
      margin-bottom: 30px;
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary-color);
    }
    
    .cart-icon {
      position: relative;
      font-size: 22px;
      color: var(--dark-color);
    }
    
    .cart-count {
      position: absolute;
      top: -10px;
      right: -10px;
      background-color: var(--danger-color);
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: var(--dark-color);
      font-weight: 600;
    }
    
    .cart-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .cart-items {
      flex: 1;
      min-width: 300px;
    }
    
    .summary-card {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      height: fit-content;
      position: sticky;
      top: 20px;
    }
    
    .summary-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    
    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    
    .summary-total {
      font-weight: 600;
      font-size: 18px;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #eee;
    }
    
    .checkout-btn {
      width: 100%;
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: var(--transition);
    }
    
    .checkout-btn:hover {
      background-color: var(--secondary-color);
    }
    
    .product-card {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      gap: 20px;
      transition: var(--transition);
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .product-image {
      width: 120px;
      height: 120px;
      object-fit: contain;
      border-radius: var(--border-radius);
      background-color: #f8f9fa;
      padding: 10px;
    }
    
    .product-details {
      flex: 1;
    }
    
    .product-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 5px;
      color: var(--dark-color);
    }
    
    .product-category {
      font-size: 14px;
      color: #6c757d;
      margin-bottom: 10px;
      display: inline-block;
      background-color: #f1f3f5;
      padding: 3px 8px;
      border-radius: 4px;
    }
    
    .product-price {
      font-size: 18px;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 15px;
    }
    
    .product-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .quantity-control {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .quantity-btn {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      border: 1px solid #ddd;
      background-color: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }
    
    .quantity-btn:hover {
      background-color: #f1f3f5;
    }
    
    .quantity {
      font-weight: 600;
      min-width: 20px;
      text-align: center;
    }
    
    .remove-btn {
      color: var(--danger-color);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: var(--transition);
    }
    
    .remove-btn:hover {
      color: #d0006e;
    }
    
    .empty-cart {
      text-align: center;
      padding: 50px 20px;
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    
    .empty-cart-icon {
      font-size: 50px;
      color: #adb5bd;
      margin-bottom: 20px;
    }
    
    .empty-cart-text {
      font-size: 18px;
      color: #6c757d;
      margin-bottom: 20px;
    }
    
    .continue-shopping {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: var(--border-radius);
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .continue-shopping:hover {
      background-color: var(--secondary-color);
    }
    
    .loading, .error {
      text-align: center;
      padding: 50px 20px;
      font-size: 18px;
    }
    
    .loading {
      color: var(--accent-color);
    }
    
    .error {
      color: var(--danger-color);
    }
    
    @media (max-width: 768px) {
      .cart-container {
        flex-direction: column;
      }
      
      .product-card {
        flex-direction: column;
      }
      
      .product-image {
        width: 100%;
        height: auto;
        max-height: 200px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-content">
      <div class="logo">ShopCart</div>
      <div class="cart-icon">
        <i class="fas fa-shopping-cart"></i>
        <span class="cart-count" id="cart-count">0</span>
      </div>
    </div>
  </header>
  
  <div class="container">
    <h1>Your Shopping Cart</h1>
    
    <div class="cart-container">
      <div class="cart-items" id="product-list">
        <!-- Products will be loaded here -->
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Loading your cart...
        </div>
      </div>
      
      <div class="summary-card">
        <h3 class="summary-title">Order Summary</h3>
        <div class="summary-row">
          <span>Subtotal</span>
          <span id="subtotal">₹0.00</span>
        </div>
        <div class="summary-row">
          <span>Shipping</span>
          <span>FREE</span>
        </div>
        <div class="summary-row summary-total">
          <span>Total</span>
          <span id="total">₹0.00</span>
        </div>
        <button class="checkout-btn">Proceed to Checkout</button>
      </div>
    </div>
  </div>

  <script>
    async function loadProducts() {
      const container = document.getElementById('product-list');
      const cartCount = document.getElementById('cart-count');
      const subtotalEl = document.getElementById('subtotal');
      const totalEl = document.getElementById('total');
      
      try {
        const email=localStorage.getItem("userEmail")
        const res = await fetch(`https://e-comerce-ws5c.onrender.com/api/cart/${email}`);
        
        if (!res.ok) {
          throw new Error('Failed to fetch cart items');
        }
        
        const data = await res.json();
        const products = data.cartItems;
        
        // Update cart count
        cartCount.textContent = data.totalItems || 0;
        
        if (!Array.isArray(products) || products.length === 0) {
          container.innerHTML = `
            <div class="empty-cart">
              <div class="empty-cart-icon">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <p class="empty-cart-text">Your cart is empty</p>
              <button class="continue-shopping">Continue Shopping</button>
            </div>
          `;
          
          // Update summary with zero values
          subtotalEl.textContent = '₹0.00';
          totalEl.textContent = '₹0.00';
        } else {
          // Calculate subtotal
          let subtotal = 0;
          
          container.innerHTML = '';
          
          products.forEach(product => {
            const productTotal = product.price * (product.quantity || 1);
            subtotal += productTotal;
            
            const card = document.createElement('div');
            card.className = 'product-card';
            
            card.innerHTML = `
              <img src="${product.url}" alt="${product.name}" class="product-image">
              <div class="product-details">
                <h3 class="product-title">${product.name}</h3>
                <span class="product-category">${product.category}</span>
                <p class="product-price">₹${product.price.toFixed(2)}</p>
                <div class="product-actions">
                  <div class="quantity-control">
                    <button class="quantity-btn minus"><i class="fas fa-minus"></i></button>
                    <span class="quantity">${product.quantity || 1}</span>
                    <button class="quantity-btn plus"><i class="fas fa-plus"></i></button>
                  </div>
                  <button class="remove-btn">
                    <i class="fas fa-trash"></i> Remove
                  </button>
                </div>
              </div>
            `;
            
            container.appendChild(card);
          });
          
          // Update summary
          subtotalEl.textContent = `₹${subtotal.toFixed(2)}`;
          totalEl.textContent = `₹${subtotal.toFixed(2)}`;
        }
        
      } catch (error) {
        console.error('Error fetching products:', error);
        container.innerHTML = `
          <div class="error">
            <i class="fas fa-exclamation-triangle"></i>
            <p>Error loading your cart. Please try again later.</p>
          </div>
        `;
      }
    }
    
    // Add event listeners for cart functionality
    document.addEventListener('click', function(e) {
      // Quantity minus button
      if (e.target.closest('.minus')) {
        const quantityEl = e.target.closest('.quantity-control').querySelector('.quantity');
        let quantity = parseInt(quantityEl.textContent);
        if (quantity > 1) {
          quantityEl.textContent = quantity - 1;
          updateCartTotals();
        }
      }
      
      // Quantity plus button
      if (e.target.closest('.plus')) {
        const quantityEl = e.target.closest('.quantity-control').querySelector('.quantity');
        let quantity = parseInt(quantityEl.textContent);
        quantityEl.textContent = quantity + 1;
        updateCartTotals();
      }
      
      // Remove button
      if (e.target.closest('.remove-btn')) {
        const productCard = e.target.closest('.product-card');
        productCard.remove();
        updateCartTotals();
      }
      
      // Continue shopping button
      if (e.target.closest('.continue-shopping')) {
        alert('Redirecting to shopping page...');
        // window.location.href = '/products';
      }
      
      // Checkout button
      if (e.target.closest('.checkout-btn')) {
        alert('Proceeding to checkout...');
        // window.location.href = '/checkout';
      }
    });
    
    function updateCartTotals() {
      const productCards = document.querySelectorAll('.product-card');
      let subtotal = 0;
      let itemCount = 0;
      
      productCards.forEach(card => {
        const price = parseFloat(card.querySelector('.product-price').textContent.replace('₹', ''));
        const quantity = parseInt(card.querySelector('.quantity').textContent);
        subtotal += price * quantity;
        itemCount += quantity;
      });
      
      // Update UI
      document.getElementById('subtotal').textContent = `₹${subtotal.toFixed(2)}`;
      document.getElementById('total').textContent = `₹${subtotal.toFixed(2)}`;
      document.getElementById('cart-count').textContent = itemCount;
      
      // If cart is now empty, show empty cart message
      if (itemCount === 0) {
        document.getElementById('product-list').innerHTML = `
          <div class="empty-cart">
            <div class="empty-cart-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <p class="empty-cart-text">Your cart is empty</p>
            <button class="continue-shopping">Continue Shopping</button>
          </div>
        `;
      }
    }

    window.addEventListener('load', loadProducts);
  </script>
</body>
</html>